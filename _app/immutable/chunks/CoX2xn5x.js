import{c as Ue,a as y,f as z}from"./BqEl5C80.js";import{p as tt,s as H,c as it,d as at,g as v,f as Be,a as nt,h as r,i as n,j as s,t as L,k as e,n as S,v as N,l as rt}from"./DVg-wcBP.js";import{d as st,s as F,e as lt}from"./Bj2CMk_O.js";import{i as K}from"./C66CeOwb.js";import{r as f,e as V,h as Le,i as G,a as Ne,g as Re,k as Pe,b as ot,f as J}from"./DZ1IOtyI.js";import{b as Q,a as D}from"./CX2Dg3vE.js";import{s as Ae}from"./Bkout0r_.js";async function ct(R,i=1200){return new Promise((k,m)=>{if(!R){m(new Error("No file provided"));return}const g=new Image;g.onload=()=>{const t=document.createElement("canvas");let c=g.width,j=g.height;c>i&&(j=Math.round(j*i/c),c=i),t.width=c,t.height=j;const P=t.getContext("2d");if(!P){m(new Error("Could not get canvas context"));return}P.drawImage(g,0,0,c,j),t.toBlob(A=>{A?k(A):m(new Error("Canvas to Blob conversion failed"))},"image/webp",.8)},g.onerror=()=>{m(new Error("Failed to load image"))},g.src=URL.createObjectURL(R)})}var dt=z('<div><label class="mb-1 block text-sm font-medium text-zinc-400 capitalize"> </label> <input type="number" class="w-full rounded-md border border-zinc-700 bg-zinc-800 p-2 text-zinc-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"/></div>'),ut=z('<label><input type="checkbox" class="sr-only"/> <span> </span> <span class="text-xs text-amber-400">(current)</span></label>'),vt=z('<label><input type="checkbox" class="sr-only"/> <span> </span></label>'),mt=z('<div class="flex flex-wrap gap-2"><!> <!></div>'),gt=z('<p class="text-sm text-zinc-500 italic">No options configured in settings</p>'),ft=z('<div><span class="mb-2 block text-sm font-medium text-zinc-400 capitalize"> </span> <!></div>'),yt=z('<p class="text-sm text-green-400">New image selected</p>'),bt=z('<div class="flex items-center gap-2"><p class="text-sm text-zinc-400">Current image set</p> <button type="button" class="text-xs text-red-400 hover:text-red-300">Remove</button></div>'),_t=z('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-2 backdrop-blur-sm md:p-4" role="dialog" aria-modal="true" tabindex="-1"><div class="flex max-h-[95vh] w-full max-w-4xl flex-col overflow-y-auto rounded-xl border border-zinc-800 bg-zinc-900 shadow-xl md:max-h-[90vh]"><div class="sticky top-0 z-10 flex items-center justify-between border-b border-zinc-800 bg-zinc-900 p-4 md:p-6"><h2 class="text-xl font-bold text-zinc-100"> </h2> <button class="text-zinc-400 transition-colors hover:text-zinc-200" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <form class="space-y-6 p-4 md:p-6"><div class="grid grid-cols-1 gap-6 md:grid-cols-2"><div><label for="created_at" class="mb-1 block text-sm font-medium text-zinc-400">Date</label> <input type="date" id="created_at" required class="w-full rounded-md border border-zinc-700 bg-zinc-800 p-2 text-zinc-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"/></div> <div><label for="weight" class="mb-1 block text-sm font-medium text-zinc-400">Weight (kg)</label> <input type="number" step="0.1" id="weight" class="w-full rounded-md border border-zinc-700 bg-zinc-800 p-2 text-zinc-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"/></div></div> <div class="grid grid-cols-2 gap-4 md:grid-cols-5"></div> <div class="flex flex-wrap gap-6"><div class="flex items-center"><input type="checkbox" id="calvin_day" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="calvin_day" class="ml-2 block text-sm text-zinc-300">Calvin Day</label></div> <div class="flex items-center"><input type="checkbox" id="ihana" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="ihana" class="ml-2 block text-sm text-zinc-300">Ihana</label></div> <div class="flex items-center"><input type="checkbox" id="call_family" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="call_family" class="ml-2 block text-sm text-zinc-300">Call Family</label></div> <div class="flex items-center"><input type="checkbox" id="cry" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="cry" class="ml-2 block text-sm text-zinc-300">Cry</label></div> <div class="flex items-center"><input type="checkbox" id="loving" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="loving" class="ml-2 block text-sm text-zinc-300">Loving</label></div> <div class="flex items-center"><input type="checkbox" id="friends" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="friends" class="ml-2 block text-sm text-zinc-300">Friends</label></div> <div class="flex items-center"><input type="checkbox" id="sickness" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="sickness" class="ml-2 block text-sm text-zinc-300">Sickness</label></div></div> <div class="grid grid-cols-1 gap-6 md:grid-cols-2"></div> <div><label for="image" class="mb-1 block text-sm font-medium text-zinc-400">Image</label> <div class="flex items-center gap-4"><input type="file" id="image" accept="image/*" class="w-full rounded-md border border-zinc-700 bg-zinc-800 p-2 text-zinc-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"/> <!></div></div> <div><label for="notes" class="mb-1 block text-sm font-medium text-zinc-400">Notes</label> <textarea id="notes" rows="3" class="w-full rounded-md border border-zinc-700 bg-zinc-800 p-2 text-zinc-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea></div> <div class="sticky bottom-0 mt-6 flex justify-end gap-3 border-t border-zinc-800 bg-zinc-900 pt-4"><button type="button" class="rounded-md bg-zinc-800 px-3.5 py-2.5 text-sm font-semibold text-zinc-200 shadow-sm ring-1 ring-zinc-700 ring-inset hover:bg-zinc-700 disabled:opacity-50">Cancel</button> <button type="submit" class="rounded-md px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm transition-all hover:brightness-110 focus-visible:outline-2 focus-visible:outline-offset-2 disabled:opacity-50"> </button></div></form></div></div>');function It(R,i){tt(i,!0);let k=H(!1),m=H(null),g=H(null),t=H(it({created_at:new Date().toISOString().split("T")[0],mood:null,energy:null,physical:null,sleep:null,meals:null,weight:null,sickness:!1,work_type:[],study_type:[],culture_type:[],art_type:[],music_type:[],exercise_type:[],leisure_type:[],calvin_day:!1,ihana:!1,call_family:!1,cry:!1,loving:!1,friends:!1,notes:"",image:null}));function c(l){return l?Array.isArray(l)?l:l.split(",").map(o=>o.trim()).filter(Boolean):[]}function j(l,o){const C=e(t)[l];C.includes(o)?e(t)[l]=C.filter(_=>_!==o):e(t)[l]=[...C,o]}at(()=>{i.isOpen&&(i.entry?(v(t,{created_at:i.entry.created_at||new Date().toISOString().split("T")[0],mood:i.entry.mood,energy:i.entry.energy,physical:i.entry.physical,sleep:i.entry.sleep,meals:i.entry.meals,weight:i.entry.weight,sickness:i.entry.sickness??!1,work_type:c(i.entry.work_type),study_type:c(i.entry.study_type),culture_type:c(i.entry.culture_type),art_type:c(i.entry.art_type),music_type:c(i.entry.music_type),exercise_type:c(i.entry.exercise_type),leisure_type:c(i.entry.leisure_type),calvin_day:i.entry.calvin_day??!1,ihana:i.entry.ihana??!1,call_family:i.entry.call_family??!1,cry:i.entry.cry??!1,loving:i.entry.loving??!1,friends:i.entry.friends??!1,notes:i.entry.notes??"",image:i.entry.image??null},!0),v(m,null),v(g,null)):(v(t,{created_at:new Date().toISOString().split("T")[0],mood:null,energy:null,physical:null,sleep:null,meals:null,weight:null,sickness:!1,work_type:[],study_type:[],culture_type:[],art_type:[],music_type:[],exercise_type:[],leisure_type:[],calvin_day:!1,ihana:!1,call_family:!1,cry:!1,loving:!1,friends:!1,notes:"",image:null},!0),v(m,null),v(g,null)))});async function P(l){const o=l.target;o.files&&o.files.length>0&&(v(m,o.files[0],!0),v(g,URL.createObjectURL(e(m)),!0))}async function A(){if(e(t).image){const{error:l}=await Ae.storage.from("dailyPicture").remove([e(t).image]);if(l){J("Failed to delete image: "+l.message,"Error");return}e(t).image=null,v(m,null),v(g,null),J("Image deleted successfully","Success")}}async function Me(l){l.preventDefault();let o=e(t).image;if(e(m)){if(!i.userId){J("User ID is missing, cannot upload image","Error");return}v(k,!0);try{const _=await ct(e(m)),O=`${i.userId}/${e(t).created_at}.webp`,{data:X,error:M}=await Ae.storage.from("dailyPicture").upload(O,_,{contentType:"image/webp",upsert:!0});if(M)throw M;o=X.path}catch(_){J(`Image upload failed: ${_.message}`,"Error"),v(k,!1);return}v(k,!1)}const C={...e(t),image:o,work_type:e(t).work_type.join(", "),study_type:e(t).study_type.join(", "),culture_type:e(t).culture_type.join(", "),art_type:e(t).art_type.join(", "),music_type:e(t).music_type.join(", "),exercise_type:e(t).exercise_type.join(", "),leisure_type:e(t).leisure_type.join(", ")};i.onSave(C)}function qe(l){l.target===l.currentTarget&&i.onClose()}function He(l){l.key==="Escape"&&i.onClose()}var be=Ue(),Ke=Be(be);{var Ve=l=>{var o=_t();o.__click=qe,o.__keydown=He;var C=r(o),_=r(C),O=r(_),X=r(O,!0);n(O);var M=s(O,2);M.__click=function(...a){i.onClose?.apply(this,a)},n(_);var Y=s(_,2),Z=r(Y),W=r(Z),_e=s(r(W),2);f(_e),n(W);var pe=s(W,2),xe=s(r(pe),2);f(xe),n(pe),n(Z);var $=s(Z,2);V($,20,()=>["mood","energy","physical","sleep","meals"],G,(a,d)=>{var I=dt(),b=r(I),p=r(b,!0);n(b);var u=s(b,2);f(u),n(I),L(()=>{Le(b,"for",d),F(p,d),Le(u,"id",d)}),Q(u,()=>e(t)[d],T=>e(t)[d]=T),y(a,I)}),n($);var ee=s($,2),te=r(ee),he=r(te);f(he),S(2),n(te);var ie=s(te,2),we=r(ie);f(we),S(2),n(ie);var ae=s(ie,2),ze=r(ae);f(ze),S(2),n(ae);var ne=s(ae,2),ke=r(ne);f(ke),S(2),n(ne);var re=s(ne,2),Ce=r(re);f(Ce),S(2),n(re);var se=s(re,2),Ie=r(se);f(Ie),S(2),n(se);var Ee=s(se,2),Se=r(Ee);f(Se),S(2),n(Ee),n(ee);var le=s(ee,2);V(le,20,()=>["work_type","study_type","culture_type","art_type","music_type","exercise_type","leisure_type"],G,(a,d)=>{const I=N(()=>d.replace("_type","")),b=N(()=>Ne.settings.daily_type[e(I)]||[]),p=N(()=>d),u=N(()=>e(t)[e(p)]),T=N(()=>e(u).filter(E=>!e(b).includes(E)));var ue=ft(),ve=r(ue),Ye=r(ve,!0);n(ve);var Ze=s(ve,2);{var We=E=>{var U=mt(),Oe=r(U);V(Oe,17,()=>e(T),G,(me,x)=>{var h=ut(),w=r(h);f(w),w.__change=()=>j(e(p),e(x));var B=s(w,2),ge=r(B,!0);n(B),S(2),n(h),L((fe,ye)=>{Re(h,1,`flex cursor-pointer items-center gap-1.5 rounded-md border px-2.5 py-1.5 text-sm transition-colors ${fe??""}`),Pe(w,ye),F(ge,e(x))},[()=>e(u).includes(e(x))?"border-amber-500 bg-amber-500/20 text-amber-300":"border-zinc-600 bg-zinc-800 text-zinc-300 hover:border-zinc-500",()=>e(u).includes(e(x))]),y(me,h)});var et=s(Oe,2);V(et,17,()=>e(b),G,(me,x)=>{var h=vt(),w=r(h);f(w),w.__change=()=>j(e(p),e(x));var B=s(w,2),ge=r(B,!0);n(B),n(h),L((fe,ye)=>{Re(h,1,`flex cursor-pointer items-center gap-1.5 rounded-md border px-2.5 py-1.5 text-sm transition-colors ${fe??""}`),Pe(w,ye),F(ge,e(x))},[()=>e(u).includes(e(x))?"border-indigo-500 bg-indigo-500/20 text-indigo-300":"border-zinc-600 bg-zinc-800 text-zinc-300 hover:border-zinc-500",()=>e(u).includes(e(x))]),y(me,h)}),n(U),y(E,U)},$e=E=>{var U=gt();y(E,U)};K(Ze,E=>{e(b).length>0||e(T).length>0?E(We):E($e,!1)})}n(ue),L(()=>F(Ye,e(I))),y(a,ue)}),n(le);var oe=s(le,2),je=s(r(oe),2),De=r(je);De.__change=P;var Ge=s(De,2);{var Je=a=>{var d=yt();y(a,d)},Qe=a=>{var d=Ue(),I=Be(d);{var b=p=>{var u=bt(),T=s(r(u),2);T.__click=A,n(u),y(p,u)};K(I,p=>{e(t).image&&p(b)},!0)}y(a,d)};K(Ge,a=>{e(g)?a(Je):a(Qe,!1)})}n(je),n(oe);var ce=s(oe,2),Te=s(r(ce),2);rt(Te),n(ce);var Fe=s(ce,2),de=r(Fe);de.__click=function(...a){i.onClose?.apply(this,a)};var q=s(de,2),Xe=r(q,!0);n(q),n(Fe),n(Y),n(C),n(o),L(a=>{F(X,i.entry?"Edit Entry":"New Entry"),de.disabled=e(k),q.disabled=e(k),ot(q,`background-color: ${a??""}`),F(Xe,e(k)?"Uploading...":"Save")},[()=>Ne.getAccentHex()]),lt("submit",Y,Me),Q(_e,()=>e(t).created_at,a=>e(t).created_at=a),Q(xe,()=>e(t).weight,a=>e(t).weight=a),D(he,()=>e(t).calvin_day,a=>e(t).calvin_day=a),D(we,()=>e(t).ihana,a=>e(t).ihana=a),D(ze,()=>e(t).call_family,a=>e(t).call_family=a),D(ke,()=>e(t).cry,a=>e(t).cry=a),D(Ce,()=>e(t).loving,a=>e(t).loving=a),D(Ie,()=>e(t).friends,a=>e(t).friends=a),D(Se,()=>e(t).sickness,a=>e(t).sickness=a),Q(Te,()=>e(t).notes,a=>e(t).notes=a),y(l,o)};K(Ke,l=>{i.isOpen&&l(Ve)})}y(R,be),nt()}st(["click","keydown","change"]);export{It as E};
