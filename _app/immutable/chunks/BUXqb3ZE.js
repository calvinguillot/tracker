import{c as Oe,a as y,f as z}from"./BqEl5C80.js";import{p as $e,s as H,c as et,d as tt,g as m,f as Ue,a as it,h as n,i as r,j as s,t as N,k as e,n as j,v as R,l as at}from"./DVg-wcBP.js";import{d as rt,s as T,e as nt}from"./Bj2CMk_O.js";import{i as K}from"./C66CeOwb.js";import{r as f,e as V,h as Be,i as G,a as Fe,g as Ne,k as Re,b as st,f as J}from"./DZ1IOtyI.js";import{b as Q,a as O}from"./CX2Dg3vE.js";import{s as Le}from"./Bkout0r_.js";async function lt(L,i=1200){return new Promise((k,v)=>{if(!L){v(new Error("No file provided"));return}const g=new Image;g.onload=()=>{const t=document.createElement("canvas");let c=g.width,S=g.height;c>i&&(S=Math.round(S*i/c),c=i),t.width=c,t.height=S;const P=t.getContext("2d");if(!P){v(new Error("Could not get canvas context"));return}P.drawImage(g,0,0,c,S),t.toBlob(A=>{A?k(A):v(new Error("Canvas to Blob conversion failed"))},"image/webp",.8)},g.onerror=()=>{v(new Error("Failed to load image"))},g.src=URL.createObjectURL(L)})}var ot=z('<div><label class="mb-1 block text-sm font-medium text-zinc-400 capitalize"> </label> <input type="number" class="w-full rounded-md border border-zinc-700 bg-zinc-800 p-2 text-zinc-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"/></div>'),ct=z('<label><input type="checkbox" class="sr-only"/> <span> </span> <span class="text-xs text-amber-400">(current)</span></label>'),dt=z('<label><input type="checkbox" class="sr-only"/> <span> </span></label>'),ut=z('<div class="flex flex-wrap gap-2"><!> <!></div>'),mt=z('<p class="text-sm text-zinc-500 italic">No options configured in settings</p>'),vt=z('<div><span class="mb-2 block text-sm font-medium text-zinc-400 capitalize"> </span> <!></div>'),gt=z('<p class="text-sm text-green-400">New image selected</p>'),yt=z('<div class="flex items-center gap-2"><p class="text-sm text-zinc-400">Current image set</p> <button type="button" class="text-xs text-red-400 hover:text-red-300">Remove</button></div>'),ft=z('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-2 backdrop-blur-sm md:p-4" role="dialog" aria-modal="true" tabindex="-1"><div class="flex max-h-[95vh] w-full max-w-4xl flex-col overflow-y-auto rounded-xl border border-zinc-800 bg-zinc-900 shadow-xl md:max-h-[90vh]"><div class="sticky top-0 z-10 flex items-center justify-between border-b border-zinc-800 bg-zinc-900 p-4 md:p-6"><h2 class="text-xl font-bold text-zinc-100"> </h2> <button class="text-zinc-400 transition-colors hover:text-zinc-200" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <form class="space-y-6 p-4 md:p-6"><div class="grid grid-cols-1 gap-6 md:grid-cols-2"><div><label for="created_at" class="mb-1 block text-sm font-medium text-zinc-400">Date</label> <input type="date" id="created_at" required class="w-full rounded-md border border-zinc-700 bg-zinc-800 p-2 text-zinc-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"/></div> <div><label for="weight" class="mb-1 block text-sm font-medium text-zinc-400">Weight (kg)</label> <input type="number" step="0.1" id="weight" class="w-full rounded-md border border-zinc-700 bg-zinc-800 p-2 text-zinc-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"/></div></div> <div class="grid grid-cols-2 gap-4 md:grid-cols-5"></div> <div class="flex flex-wrap gap-6"><div class="flex items-center"><input type="checkbox" id="sickness" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="sickness" class="ml-2 block text-sm text-zinc-300">Sickness</label></div> <div class="flex items-center"><input type="checkbox" id="calvin_day" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="calvin_day" class="ml-2 block text-sm text-zinc-300">Calvin Day</label></div> <div class="flex items-center"><input type="checkbox" id="ihana" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="ihana" class="ml-2 block text-sm text-zinc-300">Ihana</label></div> <div class="flex items-center"><input type="checkbox" id="call_family" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="call_family" class="ml-2 block text-sm text-zinc-300">Call Family</label></div> <div class="flex items-center"><input type="checkbox" id="cry" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="cry" class="ml-2 block text-sm text-zinc-300">Cry</label></div> <div class="flex items-center"><input type="checkbox" id="sex" class="h-4 w-4 rounded border-zinc-600 bg-zinc-800 text-indigo-600 focus:ring-indigo-500"/> <label for="sex" class="ml-2 block text-sm text-zinc-300">Sex</label></div></div> <div class="grid grid-cols-1 gap-6 md:grid-cols-2"></div> <div><label for="image" class="mb-1 block text-sm font-medium text-zinc-400">Image</label> <div class="flex items-center gap-4"><input type="file" id="image" accept="image/*" class="w-full rounded-md border border-zinc-700 bg-zinc-800 p-2 text-zinc-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"/> <!></div></div> <div><label for="notes" class="mb-1 block text-sm font-medium text-zinc-400">Notes</label> <textarea id="notes" rows="3" class="w-full rounded-md border border-zinc-700 bg-zinc-800 p-2 text-zinc-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea></div> <div class="sticky bottom-0 mt-6 flex justify-end gap-3 border-t border-zinc-800 bg-zinc-900 pt-4"><button type="button" class="rounded-md bg-zinc-800 px-3.5 py-2.5 text-sm font-semibold text-zinc-200 shadow-sm ring-1 ring-zinc-700 ring-inset hover:bg-zinc-700 disabled:opacity-50">Cancel</button> <button type="submit" class="rounded-md px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm transition-all hover:brightness-110 focus-visible:outline-2 focus-visible:outline-offset-2 disabled:opacity-50"> </button></div></form></div></div>');function kt(L,i){$e(i,!0);let k=H(!1),v=H(null),g=H(null),t=H(et({created_at:new Date().toISOString().split("T")[0],mood:null,energy:null,physical:null,sleep:null,meals:null,weight:null,sickness:!1,work_type:[],study_type:[],culture_type:[],art_type:[],music_type:[],exercise_type:[],leisure_type:[],calvin_day:!1,ihana:!1,call_family:!1,cry:!1,sex:!1,notes:"",image:null}));function c(l){return l?Array.isArray(l)?l:l.split(",").map(o=>o.trim()).filter(Boolean):[]}function S(l,o){const C=e(t)[l];C.includes(o)?e(t)[l]=C.filter(b=>b!==o):e(t)[l]=[...C,o]}tt(()=>{i.isOpen&&(i.entry?(m(t,{created_at:i.entry.created_at||new Date().toISOString().split("T")[0],mood:i.entry.mood,energy:i.entry.energy,physical:i.entry.physical,sleep:i.entry.sleep,meals:i.entry.meals,weight:i.entry.weight,sickness:i.entry.sickness??!1,work_type:c(i.entry.work_type),study_type:c(i.entry.study_type),culture_type:c(i.entry.culture_type),art_type:c(i.entry.art_type),music_type:c(i.entry.music_type),exercise_type:c(i.entry.exercise_type),leisure_type:c(i.entry.leisure_type),calvin_day:i.entry.calvin_day??!1,ihana:i.entry.ihana??!1,call_family:i.entry.call_family??!1,cry:i.entry.cry??!1,sex:i.entry.sex??!1,notes:i.entry.notes??"",image:i.entry.image??null},!0),m(v,null),m(g,null)):(m(t,{created_at:new Date().toISOString().split("T")[0],mood:null,energy:null,physical:null,sleep:null,meals:null,weight:null,sickness:!1,work_type:[],study_type:[],culture_type:[],art_type:[],music_type:[],exercise_type:[],leisure_type:[],calvin_day:!1,ihana:!1,call_family:!1,cry:!1,sex:!1,notes:"",image:null},!0),m(v,null),m(g,null)))});async function P(l){const o=l.target;o.files&&o.files.length>0&&(m(v,o.files[0],!0),m(g,URL.createObjectURL(e(v)),!0))}async function A(){if(e(t).image){const{error:l}=await Le.storage.from("dailyPicture").remove([e(t).image]);if(l){J("Failed to delete image: "+l.message,"Error");return}e(t).image=null,m(v,null),m(g,null),J("Image deleted successfully","Success")}}async function Pe(l){l.preventDefault();let o=e(t).image;if(e(v)){if(!i.userId){J("User ID is missing, cannot upload image","Error");return}m(k,!0);try{const b=await lt(e(v)),U=`${i.userId}/${e(t).created_at}.webp`,{data:X,error:M}=await Le.storage.from("dailyPicture").upload(U,b,{contentType:"image/webp",upsert:!0});if(M)throw M;o=X.path}catch(b){J(`Image upload failed: ${b.message}`,"Error"),m(k,!1);return}m(k,!1)}const C={...e(t),image:o,work_type:e(t).work_type.join(", "),study_type:e(t).study_type.join(", "),culture_type:e(t).culture_type.join(", "),art_type:e(t).art_type.join(", "),music_type:e(t).music_type.join(", "),exercise_type:e(t).exercise_type.join(", "),leisure_type:e(t).leisure_type.join(", ")};i.onSave(C)}function Ae(l){l.target===l.currentTarget&&i.onClose()}function Me(l){l.key==="Escape"&&i.onClose()}var fe=Oe(),qe=Ue(fe);{var He=l=>{var o=ft();o.__click=Ae,o.__keydown=Me;var C=n(o),b=n(C),U=n(b),X=n(U,!0);r(U);var M=s(U,2);M.__click=function(...a){i.onClose?.apply(this,a)},r(b);var Y=s(b,2),Z=n(Y),W=n(Z),_e=s(n(W),2);f(_e),r(W);var be=s(W,2),pe=s(n(be),2);f(pe),r(be),r(Z);var $=s(Z,2);V($,20,()=>["mood","energy","physical","sleep","meals"],G,(a,d)=>{var I=ot(),_=n(I),p=n(_,!0);r(_);var u=s(_,2);f(u),r(I),N(()=>{Be(_,"for",d),T(p,d),Be(u,"id",d)}),Q(u,()=>e(t)[d],D=>e(t)[d]=D),y(a,I)}),r($);var ee=s($,2),te=n(ee),xe=n(te);f(xe),j(2),r(te);var ie=s(te,2),he=n(ie);f(he),j(2),r(ie);var ae=s(ie,2),we=n(ae);f(we),j(2),r(ae);var re=s(ae,2),ze=n(re);f(ze),j(2),r(re);var ne=s(re,2),ke=n(ne);f(ke),j(2),r(ne);var Ce=s(ne,2),Ie=n(Ce);f(Ie),j(2),r(Ce),r(ee);var se=s(ee,2);V(se,20,()=>["work_type","study_type","culture_type","art_type","music_type","exercise_type","leisure_type"],G,(a,d)=>{const I=R(()=>d.replace("_type","")),_=R(()=>Fe.settings.daily_type[e(I)]||[]),p=R(()=>d),u=R(()=>e(t)[e(p)]),D=R(()=>e(u).filter(E=>!e(_).includes(E)));var de=vt(),ue=n(de),Qe=n(ue,!0);r(ue);var Xe=s(ue,2);{var Ye=E=>{var B=ut(),Te=n(B);V(Te,17,()=>e(D),G,(me,x)=>{var h=ct(),w=n(h);f(w),w.__change=()=>S(e(p),e(x));var F=s(w,2),ve=n(F,!0);r(F),j(2),r(h),N((ge,ye)=>{Ne(h,1,`flex cursor-pointer items-center gap-1.5 rounded-md border px-2.5 py-1.5 text-sm transition-colors ${ge??""}`),Re(w,ye),T(ve,e(x))},[()=>e(u).includes(e(x))?"border-amber-500 bg-amber-500/20 text-amber-300":"border-zinc-600 bg-zinc-800 text-zinc-300 hover:border-zinc-500",()=>e(u).includes(e(x))]),y(me,h)});var We=s(Te,2);V(We,17,()=>e(_),G,(me,x)=>{var h=dt(),w=n(h);f(w),w.__change=()=>S(e(p),e(x));var F=s(w,2),ve=n(F,!0);r(F),r(h),N((ge,ye)=>{Ne(h,1,`flex cursor-pointer items-center gap-1.5 rounded-md border px-2.5 py-1.5 text-sm transition-colors ${ge??""}`),Re(w,ye),T(ve,e(x))},[()=>e(u).includes(e(x))?"border-indigo-500 bg-indigo-500/20 text-indigo-300":"border-zinc-600 bg-zinc-800 text-zinc-300 hover:border-zinc-500",()=>e(u).includes(e(x))]),y(me,h)}),r(B),y(E,B)},Ze=E=>{var B=mt();y(E,B)};K(Xe,E=>{e(_).length>0||e(D).length>0?E(Ye):E(Ze,!1)})}r(de),N(()=>T(Qe,e(I))),y(a,de)}),r(se);var le=s(se,2),Ee=s(n(le),2),Se=n(Ee);Se.__change=P;var Ke=s(Se,2);{var Ve=a=>{var d=gt();y(a,d)},Ge=a=>{var d=Oe(),I=Ue(d);{var _=p=>{var u=yt(),D=s(n(u),2);D.__click=A,r(u),y(p,u)};K(I,p=>{e(t).image&&p(_)},!0)}y(a,d)};K(Ke,a=>{e(g)?a(Ve):a(Ge,!1)})}r(Ee),r(le);var oe=s(le,2),je=s(n(oe),2);at(je),r(oe);var De=s(oe,2),ce=n(De);ce.__click=function(...a){i.onClose?.apply(this,a)};var q=s(ce,2),Je=n(q,!0);r(q),r(De),r(Y),r(C),r(o),N(a=>{T(X,i.entry?"Edit Entry":"New Entry"),ce.disabled=e(k),q.disabled=e(k),st(q,`background-color: ${a??""}`),T(Je,e(k)?"Uploading...":"Save")},[()=>Fe.getAccentHex()]),nt("submit",Y,Pe),Q(_e,()=>e(t).created_at,a=>e(t).created_at=a),Q(pe,()=>e(t).weight,a=>e(t).weight=a),O(xe,()=>e(t).sickness,a=>e(t).sickness=a),O(he,()=>e(t).calvin_day,a=>e(t).calvin_day=a),O(we,()=>e(t).ihana,a=>e(t).ihana=a),O(ze,()=>e(t).call_family,a=>e(t).call_family=a),O(ke,()=>e(t).cry,a=>e(t).cry=a),O(Ie,()=>e(t).sex,a=>e(t).sex=a),Q(je,()=>e(t).notes,a=>e(t).notes=a),y(l,o)};K(qe,l=>{i.isOpen&&l(He)})}y(L,fe),it()}rt(["click","keydown","change"]);export{kt as E};
